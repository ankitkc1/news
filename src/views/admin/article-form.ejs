<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js"></script>

<form
  method="POST"
  enctype="multipart/form-data"
  action="<%= mode === 'create' ? '/admin/articles' : ('/admin/articles/' + article._id + '?_method=PUT') %>"
>
  <label>Title</label>
  <input name="title" value="<%= article?.title || '' %>" required />

  <label>Excerpt (shown to guests)</label>
  <textarea name="excerpt" rows="3" required><%= article?.excerpt || '' %></textarea>

  <div class="two">
    <div>
      <label>Category</label>
      <input name="category" value="<%= article?.category || 'General' %>"/>
    </div>
    <div>
      <label>Tags (comma separated)</label>
      <input name="tags" value="<%= (article?.tags || []).join(', ') %>"/>
    </div>
  </div>

  <label>Cover Image (Upload)</label>
  <input type="file" name="coverImageFile" accept="image/png,image/jpeg,image/webp" />

  <label>OR Cover Image URL</label>
  <input name="coverImageUrl" value="<%= article?.coverImageUrl || '' %>" placeholder="https://..." />

  <% if (article?.coverImageUrl) { %>
    <p class="muted">Current image:</p>
    <img src="<%= article.coverImageUrl %>" class="thumb" alt="Current cover" />
  <% } %>

  <label>Content</label>

<!-- store existing HTML for edit mode -->
<div id="existingHtml" style="display:none;"><%- article?.contentHtml || "" %></div>

<div id="editor" class="editor"></div>

<input type="hidden" name="contentHtml" id="contentHtml" />

<label class="check">
  <input type="hidden" name="published" value="false" />
  <input
    type="checkbox"
    name="published"
    value="true"
    <%= article?.published ? "checked" : "" %>
  />
  Published
</label>




  <button class="btn" type="submit"><%= mode === "create" ? "Publish" : "Save" %></button>
</form>

<script>
  window.addEventListener("load", () => {
    const editorEl = document.getElementById("editor");
    const hidden = document.getElementById("contentHtml");

    //if CDN didn't load,  message inside the box will apear
    if (typeof Quill === "undefined") {
      editorEl.innerHTML =
        "<div style='padding:12px;color:#b91c1c;font-weight:600'>Quill is not loading (CDN blocked/offline). Install Quill locally (fix below).</div>";
      return;
    }

    const quill = new Quill(editorEl, {
      theme: "snow",
      placeholder: "Write your article here...",
      modules: {
        toolbar: [
          [{ header: [1, 2, 3, false] }],
          ["bold", "italic", "underline", "strike"],
          [{ list: "ordered" }, { list: "bullet" }],
          ["link", "image", "blockquote"],
          ["clean"]
        ]
      }
    });

    //load existing content for edit mode
    const existing = document.getElementById("existingHtml").innerHTML;
    if (existing.trim()) quill.root.innerHTML = existing;

    //keep hidden input always updated
    hidden.value = quill.root.innerHTML;
    quill.on("text-change", () => {
      hidden.value = quill.root.innerHTML;
    });

    // focus editor
    quill.focus();
  });
</script>
